if(typeof window._apiAvailable=='undefined'){window._apiAvailable=false;window._msgApiUnavailable=null;window._msgAdjustConsigneUnavailable=null;window.canReset=[];window.adjAvailable=[];window.msgEnforceConsigne=[];window.spScheduled=[];window.spCurrent=[];window.adjustLow=[];window.adjustHigh=[];window.adjustStep=[];window.adjustPrepared=[];window.cmdSetConsigneId=[];window.initialSrc=[];window.initialTitle=[];window.adjRunning=[];window.C2BG={'25':'#f21f1f','22':'#ff5b1a','19':'#fa9e2d','16':'#2e9985'};window.tlrTimeout=[];window.thTimeout=[];}
function flipTLR(_id){if($('#hoverTLRShowB'+_id).is(":visible")){$('#hoverTLRShowB'+_id).hide();clearTimeout(tlrTimeout[_id]);}else{$('#hoverTLRShowB'+_id).show();tlrTimeout[_id]=setTimeout(function(){$('#hoverTLRShowB'+_id).hide();},4000);}}
function hideTLR(_id){$('#hoverTLRShowB'+_id).hide();clearTimeout(tlrTimeout[_id]);}
function initVarsCommon(_id,pEvoBackgroundColor,pEvoCmdBackgroundColor,pApiAvailable,pMsgApiUnavailable,evoDefaultShowingScheduleMode){_apiAvailable=pApiAvailable;_msgApiUnavailable=pMsgApiUnavailable;if(typeof window.__generalLastMode=='undefined'){window.__generalLastMode=evoDefaultShowingScheduleMode;window.evoCmdBackgroundColor=pEvoCmdBackgroundColor;var _style="<style>"+".hoverTLRShow { display:none;padding:2px;position:absolute;left:50px;topx:16px;cursor:default;z-index:10;"+"background-color:"+pEvoBackgroundColor+";color:black;border:solid 1px black;"+"text-align:left;font-size:12px;white-space:nowrap; }"+".TH1 { margin-left:10px;margin-right:10px;height:46px;text-align:center;background-color:lightgray; }"+".TH1s { font-size:32px;font-weight:400;font-family:'Open Sans', sans-serif; }"+".hoverTH { float:left;margin-left:5px;height:46px;cursor:pointer;color:black; }"+".hoverTH:hoverw .hoverTHShow { display: block; }"+".hoverTH .hoverTHShow {"+"display:none;"+"position:absolute;left:50px;top:-10px;width:320px;"+"text-align:left;font-size:12px;"+"background-color:"+pEvoBackgroundColor+";"+"z-index:10;"+"}"+".THSAt { line-height:8px;margin-top:5px;font-size:10.5px;background-color:lightgray !important; }"+".THSAd1 { padding-bottom:1.5px;border-bottom:dotted black 1px; }"+".THSAd2 { padding-top:1.5px;padding-bottom:1.5px;border-bottom:dotted black 1px; }"+".THSAd3 { padding-top:1.5px; }"+".hoverTHShow table tr td { padding:2px 2px 2px 4px; display:table-cell; }"+".THSBd1 { text-align:center;border-bottom:solid 1px black;font-style:italic;font-weight:bold;background-color:darkgray; }"+".TH2t { border:none;margin-left:10px;margin-right:10px; }"+".TH2d1 { border-radius:3px;background-color:"+pEvoCmdBackgroundColor+"; }"+".TH2d1a { padding-left:5px;padding-right:5px;padding-top:2px;padding-bottom:2px; }"+".TH2d2 { border-radius:3px;background-color:"+pEvoCmdBackgroundColor+"; }"+".TH2d2a { padding-left:5px;padding-right:5px;padding-top:2px;padding-bottom:2px; }"+".TH2d3s1 { font-size:15px;font-family:'Open Sans', sans-serif;line-height:30px; }"+".TH2d3s2 { line-height:30px;font-size:11.5px;cursor:default; }"+".TH2d3s2i { height:13px;vertical-align:text-bottom; }"+".TH2d4a1 { display:block;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;"+"font-size:8px;line-height:16px;border-radius:2px;background-color:"+pEvoCmdBackgroundColor+"; }"+".TH2d4a2 { display:block;padding-left:5px;padding-right:5px;padding-top:0px;padding-bottom:0px;"+"font-size:8px;line-height:15px;border-radius:2px;background-color:"+pEvoCmdBackgroundColor+"; }"+".TH2d5 { border-radius:3px;background-color:"+pEvoCmdBackgroundColor+"; }"+".TH2d5a { font-size:10px;padding-left:5px;padding-right:5px;padding-top:2px;padding-bottom:2px; }"+".statDelta { font-size:10px;color:black;cursor:default; }"+"</style>";$('head').append(_style);}}
var __showHorizontal;var __argZoneId;var __argFileId;function initVarsTH(_id,pEvoBackgroundColor,pEvoCmdBackgroundColor,pApiAvailable,pMsgApiUnavailable,pEvoDefaultShowingScheduleMode,pShowHorizontal,pArgZoneId,pArgFileId){initVarsCommon(_id,pEvoBackgroundColor,pEvoCmdBackgroundColor,pApiAvailable,pMsgApiUnavailable,pEvoDefaultShowingScheduleMode);__showHorizontal=pShowHorizontal;__argZoneId=pArgZoneId;__argFileId=pArgFileId;$('.showSavedScheduleCaption'+_id).css('color',getScheduleListId()==0?'gray':'white');}
function flipTH(_id){if($('#hoverTHShowB'+_id).is(":visible")){$('#hoverTHShowB'+_id).hide();clearTimeout(thTimeout[_id]);}else{$('#hoverTHShowB'+_id).show();thTimeout[_id]=setTimeout(function(){$('#hoverTHShowB'+_id).hide();},10000);}}
function hideTH(_id){$('#hoverTHShowB'+_id).hide();clearTimeout(thTimeout[_id]);}
function checkApiAvailable(){if(!_apiAvailable){myAlert(_msgApiUnavailable);return false;}
return true;}
function getScheduleListId(){return typeof genConsoleId=='undefined'||$('#scheduleList'+genConsoleId).length==0?0:$('#scheduleList'+genConsoleId).value();}
function _showScheduleTH(id,zoneId,type){if($('.showCurrentSchedule'+type+id).css("background-color")!="rgb(16, 208, 16)"){showScheduleTH(id,zoneId,type);}else{$('#md_modal').dialog('close');}}
function showScheduleTH(id,zoneId,type,mode){__generalLastMode=mode==null?__generalLastMode:mode;$('#md_modal').dialog('close');$('#md_modal').dialog({title:"",height:'auto',width:(__generalLastMode==__showHorizontal?Math.min(1000,jQuery(window).width()-16):700),position:{my:"center top",at:"center top+50",of:window}});var fileId=type=='C'?0:$('#scheduleList'+genConsoleId+' option:selected').value();$('#md_modal').load('index.php?v=d&plugin=evohome&modal=schedule'+__generalLastMode+'&id='+id+'&'+__argZoneId+'='+zoneId+'&'+__argFileId+'='+fileId+'&edit=0&mode='+__generalLastMode+'&typeSchedule='+type).dialog('open');$('.showCurrentSchedule'+type+id).css("background-color","rgb(16, 208, 16)");}
$('#md_modal').on('dialogclose',function(){restoreCmdBgdColor();});function restoreCmdBgdColor(){$('.showCS').css("background-color",evoCmdBackgroundColor);}
function waitingMessage(text){bootbox.dialog({message:"<div class='text-center'>"+text+"...</div>",closeButton:false});$('#md_modal').dialog('close');$('#jqueryLoadingDiv').show();}
function myAlert(text){bootbox.alert({message:text,closeButton:false});}
function myConfirm(text){return confirm(text);}
function refreshReset(zoneId,pCanReset){canReset[zoneId]=pCanReset;$('#zidAdjustResetIcon'+zoneId).css('color',_apiAvailable&&adjAvailable[zoneId]&&canReset[zoneId]?'white':'gray');return pCanReset;}
function initVarsAC(pAdjAvailable,pMsgAdjustConsigneUnavailable,pMsgEnforceConsigne,zoneId,pCurrentConsigne,pConsigne,pAdjustLow,pAdjustHigh,pAdjustStep,pCmdSetConsigneId,pCanReset){if(pCmdSetConsigneId.substr(0,1)=="#"){$('#zidAdjustMinus'+zoneId).hide();$('#zidAdjustPlus'+zoneId).hide();$('#zidAdjustReset'+zoneId).hide();}else{_msgAdjustConsigneUnavailable=pMsgAdjustConsigneUnavailable;adjAvailable[zoneId]=pAdjAvailable=='true';msgEnforceConsigne[zoneId]=pMsgEnforceConsigne;spScheduled[zoneId]=parseFloat(pCurrentConsigne);spCurrent[zoneId]=parseFloat(pConsigne);adjustLow[zoneId]=parseFloat(pAdjustLow);adjustHigh[zoneId]=parseFloat(pAdjustHigh);adjustStep[zoneId]=parseFloat(pAdjustStep);cmdSetConsigneId[zoneId]=parseInt(pCmdSetConsigneId);initialSrc[zoneId]=$('#zidSpImg'+zoneId).attr('src');initialTitle[zoneId]=$('#zidSpDisplayImg'+zoneId).attr('title');refresh3Buttons(zoneId,_apiAvailable&&adjAvailable[zoneId],pCanReset);adjRunning[zoneId]=false;}}
function refresh3Buttons(zoneId,pCanAdjust,pCanReset){if(!pCanAdjust){adjRunning[zoneId]=true;$('#zidAdjustMinusIcon'+zoneId).css('color','gray');$('#zidAdjustPlusIcon'+zoneId).css('color','gray');}
refreshReset(zoneId,pCanReset);}
function checkAdjAvailability(zoneId){if(!checkApiAvailable())return false;if(!adjAvailable[zoneId]){myAlert(_msgAdjustConsigneUnavailable);return false;}
return!adjRunning[zoneId];}
function adjust(zoneId,step){if(!checkAdjAvailability(zoneId))return;var sp=parseFloat($('#zidConsigne'+zoneId)[0].innerHTML.replace('°',''));var nStep=step==-1&&sp>adjustLow[zoneId]?-adjustStep[zoneId]:step==1&&sp<adjustHigh[zoneId]?adjustStep[zoneId]:0;if(nStep!=0){prepareAdjust(zoneId,sp+nStep);}}
function resetConsigne(zoneId){if(!checkAdjAvailability(zoneId))return;if(canReset[zoneId]){prepareAdjust(zoneId,0);}}
function prepareAdjust(zoneId,sp){$('#zidConsigne'+zoneId)[0].innerHTML=(sp==0?spScheduled[zoneId]:sp)+"°";refreshReset(zoneId,sp!=0&&sp!=spScheduled[zoneId]);if(sp==0||sp==spScheduled[zoneId]){$('#zidSpDisplayImg'+zoneId).hide();$('#zidConsigneTypeUntil'+zoneId).hide();}else if(sp!=0&&sp!=spCurrent[zoneId]){$('#zidSpImg'+zoneId).attr('src','plugins/evohome/img/override-active.png');$('#zidSpDisplayImg'+zoneId).attr('title',msgEnforceConsigne[zoneId]);$('#zidSpDisplayImg'+zoneId).show();$('#zidConsigneTypeUntil'+zoneId).hide();}else{$('#zidSpImg'+zoneId).attr('src',initialSrc[zoneId]);$('#zidSpDisplayImg'+zoneId).attr('title',initialTitle[zoneId]);if(initialTitle[zoneId]=='')$('#zidSpDisplayImg'+zoneId).hide();else $('#zidSpDisplayImg'+zoneId).show();$('#zidConsigneTypeUntil'+zoneId).show();}
var spx=sp==0?spScheduled[zoneId]:sp;adjustBackground(zoneId,spx);if(adjustPrepared[zoneId]!=null)clearTimeout(adjustPrepared[zoneId]);if(spx!=spCurrent[zoneId]){adjustPrepared[zoneId]=setTimeout(function(){consignesData='manuel#'+zoneId+'#'+sp+'#'+spx+'#null';jeedom.cmd.execute({id:cmdSetConsigneId[zoneId],notify:true,value:{'select':consignesData}});showSettingTemp(zoneId);},4000);}}
function showSettingTemp(zoneId){$('#zidSpDisplayImg'+zoneId).hide();$('#zidSetTempSpinner'+zoneId).show();$('#zidBackConsigne'+zoneId).css('background-color','gray');refresh3Buttons(zoneId,false,false);}
function adjustBackground(zoneId,sp){var bg='#247eb2';for(ref in C2BG){if(sp>=parseInt(ref)){bg=C2BG[ref];}}
$('#zidBackConsigne'+zoneId).css('background-color',bg);}